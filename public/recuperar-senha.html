<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recuperar Senha | Consigaz</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:#f9fafb;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
        .container{background:white;padding:40px;border-radius:20px;box-shadow:0 4px 24px rgba(0,0,0,0.08);width:100%;max-width:400px}
        .back-link{display:inline-flex;align-items:center;gap:6px;color:#6b7280;text-decoration:none;font-size:14px;margin-bottom:24px}
        .header{text-align:center;margin-bottom:32px}
        .logo{margin-bottom:24px}
        .logo img{max-width:160px;height:auto}
        h1{font-size:22px;font-weight:600;color:#1f2937;margin-bottom:8px}
        .subtitle{color:#6b7280;font-size:14px}
        .form-group{margin-bottom:20px}
        label{display:block;font-size:13px;font-weight:500;color:#374151;margin-bottom:6px}
        input,select{width:100%;padding:12px 16px;border:1px solid #d1d5db;border-radius:10px;font-size:15px}
        input:focus,select:focus{outline:none;border-color:#053462;box-shadow:0 0 0 3px rgba(5,52,98,0.1)}
        .btn{width:100%;padding:14px;background:#053462;color:white;border:none;border-radius:10px;font-size:15px;font-weight:500;cursor:pointer}
        .btn:hover{background:#0a4a8a}
        .alert{padding:14px 16px;border-radius:10px;margin-bottom:20px;font-size:14px}
        .alert-success{background:#ecfdf5;color:#059669;border:1px solid #a7f3d0}
        .alert-error{background:#fef2f2;color:#dc2626;border:1px solid #fecaca}
        .hidden{display:none}
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>Voltar</a>
        <div class="header">
            <div class="logo"><img src="https://propangas.com.br/wp-content/uploads/2024/09/logo-consigaz.png" alt="Consigaz"></div>
            <h1>Recuperar Senha</h1>
        </div>
        
        <div id="step1">
            <p class="subtitle" style="text-align:center;margin-bottom:24px">Digite seu login para receber instruções</p>
            <div id="alert1" class="alert hidden"></div>
            <form id="form1">
                <div class="form-group"><label>Tipo de Usuário</label><select id="tipo"><option value="colaborador">Colaborador</option><option value="distribuidor">Distribuidor</option><option value="admin">Administrador</option></select></div>
                <div class="form-group"><label>CPF, CNPJ ou Email</label><input id="login" placeholder="Digite seu login" required></div>
                <button type="submit" class="btn">Enviar Instruções</button>
            </form>
        </div>
        
        <div id="step2" class="hidden">
            <p class="subtitle" style="text-align:center;margin-bottom:24px">Digite o token recebido e sua nova senha</p>
            <div id="alert2" class="alert hidden"></div>
            <form id="form2">
                <div class="form-group"><label>Token de Recuperação</label><input id="token" placeholder="Cole o token aqui" required></div>
                <div class="form-group"><label>Nova Senha</label><input type="password" id="novaSenha" placeholder="Mínimo 6 caracteres" required minlength="6"></div>
                <div class="form-group"><label>Confirmar Senha</label><input type="password" id="confirmar" placeholder="Repita a senha" required></div>
                <button type="submit" class="btn">Alterar Senha</button>
            </form>
        </div>
    </div>
    <script>
        const params=new URLSearchParams(location.search);
        if(params.get('token')){document.getElementById('step1').classList.add('hidden');document.getElementById('step2').classList.remove('hidden');document.getElementById('token').value=params.get('token')}
        if(params.get('tipo'))document.getElementById('tipo').value=params.get('tipo');
        
        document.getElementById('form1').onsubmit=async e=>{e.preventDefault();const a=document.getElementById('alert1');try{const r=await fetch('/api/auth/recuperar-senha/solicitar',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({tipo:document.getElementById('tipo').value,login:document.getElementById('login').value})});const d=await r.json();a.className='alert alert-success';a.textContent=d.mensagem||'Se o usuário existir, as instruções foram enviadas.';a.classList.remove('hidden');setTimeout(()=>{document.getElementById('step1').classList.add('hidden');document.getElementById('step2').classList.remove('hidden')},2500)}catch(err){a.className='alert alert-error';a.textContent='Erro de conexão';a.classList.remove('hidden')}};
        
        document.getElementById('form2').onsubmit=async e=>{e.preventDefault();const a=document.getElementById('alert2');if(document.getElementById('novaSenha').value!==document.getElementById('confirmar').value){a.className='alert alert-error';a.textContent='As senhas não coincidem';a.classList.remove('hidden');return}try{const r=await fetch('/api/auth/recuperar-senha/confirmar',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token:document.getElementById('token').value,novaSenha:document.getElementById('novaSenha').value})});const d=await r.json();if(d.sucesso){a.className='alert alert-success';a.textContent='Senha alterada com sucesso!';a.classList.remove('hidden');setTimeout(()=>location.href='index.html',2000)}else{a.className='alert alert-error';a.textContent=d.erro||'Token inválido ou expirado';a.classList.remove('hidden')}}catch(err){a.className='alert alert-error';a.textContent='Erro de conexão';a.classList.remove('hidden')}};
    </script>
</body>
</html>
